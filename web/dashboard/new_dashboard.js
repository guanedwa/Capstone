(function () {
  'use strict'

  feather.replace()

  // line chart
  var ctx = document.getElementById('myChart').getContext('2d');
  var myChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [
  '2005-09-26', '2005-10-24', '2005-11-21', '2005-12-19', '2006-01-16',
  '2006-02-13', '2006-03-13', '2006-04-10', '2006-05-08', '2006-06-05',
  '2006-07-03', '2006-07-31', '2006-08-28', '2006-09-25', '2006-10-23',
  '2006-11-20', '2006-12-18', '2007-01-15', '2007-02-12', '2007-03-12',
  '2007-04-09', '2007-05-07', '2007-06-04', '2007-07-02', '2007-07-30',
  '2007-08-27', '2007-09-24', '2007-10-22', '2007-11-19', '2007-12-17',
  '2008-01-14', '2008-02-11', '2008-03-10', '2008-04-07', '2008-05-05',
  '2008-06-02', '2008-06-30', '2008-07-28', '2008-08-25', '2008-09-22',
  '2008-10-20', '2008-11-17', '2008-12-15', '2009-01-12', '2009-02-09',
  '2009-03-09', '2009-04-06', '2009-05-04', '2009-06-01', '2009-06-29',
  '2009-07-27', '2009-08-24', '2009-09-21', '2009-10-19', '2009-11-16',
  '2009-12-14', '2010-01-11', '2010-02-08', '2010-03-08', '2010-04-05',
  '2010-05-03', '2010-05-31', '2010-06-28', '2010-07-26', '2010-08-23',
  '2010-09-20', '2010-10-18', '2010-11-15', '2010-12-13', '2011-01-10',
  '2011-02-07', '2011-03-07', '2011-04-04', '2011-05-02', '2011-05-30',
  '2011-06-27', '2011-07-25', '2011-08-22', '2011-09-19', '2011-10-17',
  '2011-11-14', '2011-12-12', '2012-01-09', '2012-02-06', '2012-03-05',
  '2012-04-02', '2012-04-30', '2012-05-28', '2012-06-25', '2012-07-23',
  '2012-08-20', '2012-09-17', '2012-10-15', '2012-11-12', '2012-12-10',
  '2013-01-07', '2013-02-04', '2013-03-04', '2013-04-01', '2013-04-29',
  '2013-05-27', '2013-06-24', '2013-07-22', '2013-08-19', '2013-09-16',
  '2013-10-14', '2013-11-11', '2013-12-09', '2014-01-06', '2014-02-03',
  '2014-03-03', '2014-03-31', '2014-04-28', '2014-05-26', '2014-06-23',
  '2014-07-21', '2014-08-18', '2014-09-15', '2014-10-13', '2014-11-10',
  '2014-12-08', '2015-01-05', '2015-02-02', '2015-03-02', '2015-03-30',
  '2015-04-27', '2015-05-25', '2015-06-22', '2015-07-20', '2015-08-17',
  '2015-09-14', '2015-10-12', '2015-11-09', '2015-12-07', '2016-01-04',
  '2016-02-01', '2016-02-29', '2016-03-28', '2016-04-25', '2016-05-23',
  '2016-06-20', '2016-07-18', '2016-08-15', '2016-09-12', '2016-10-10',
  '2016-11-07', '2016-12-05', '2017-01-02', '2017-01-30', '2017-02-27',
  '2017-03-27', '2017-04-24', '2017-05-22', '2017-06-19', '2017-07-17',
  '2017-08-14', '2017-09-11', '2017-10-09', '2017-11-06', '2017-12-04',
  '2018-01-01', '2018-01-29', '2018-02-26', '2018-03-26', '2018-04-23',
  '2018-05-21', '2018-06-18', '2018-07-16', '2018-08-13', '2018-09-10',
  '2018-10-08', '2018-11-05', '2018-12-03', '2018-12-31', '2019-01-28',
  '2019-02-25', '2019-03-25', '2019-04-22', '2019-05-20', '2019-06-17',
  '2019-07-15', '2019-08-12', '2019-09-09', '2019-10-07', '2019-11-04',
  '2019-12-02', '2019-12-30'
]
,
      
      datasets: [{
        label: "Constructed Portfolio",
        data: [
                   1,                  1, 1.0073010399702673, 0.9920169196498911,
   1.070235525836907, 1.0829194595145881, 1.0920042328355053, 1.1095595737975066,
  1.0301687601899723, 0.9757775303138376, 0.9681366432196987, 1.0073562607106985,
  1.0266752859210175, 1.0307808598281762, 1.0999858546476977, 1.0893378053607505,
  1.0920994746378958, 1.1238066344890483,  1.035609475841305, 1.0504391831746591,
  1.0718368208277294, 1.0334566798334488, 1.1067169072587895, 0.9851079434526955,
  1.0607164670055913,  1.033788774225736, 1.0287956975329278, 1.0199810174416293,
  1.0316647461081954, 0.9403640718933391, 0.9309650687154127, 0.9054073640166623,
  0.9315045447077255, 0.9578994482321822, 0.9416420605299028,  0.932463285799186,
  0.9808500990376342,  1.042861958272758, 1.0195009222512055, 0.8198337026397265,
  0.8534791588549479, 0.8799201684001818,  0.886217571472084, 0.8535835036827994,
  0.7858328121102213, 0.8412367077399492, 0.8708043682757364, 0.8603481546157727,
  0.8482231350443055, 0.9572382916812926, 0.9940773728035177, 1.0195279758208116,
   1.024241140636021, 1.0057948782672057, 1.0686569701019175, 1.1460891958286805,
  1.1068142749649796, 1.2289844114809316, 1.2802299007330327, 1.1544521789869309,
  1.1649564406440827,  1.080673622836253, 1.2026016704519134, 1.1252715308696752,
  1.2322694076689196, 1.3125392592742016, 1.3018539039324082, 1.3709269627618463,
  1.4504073441577516,  1.472791209773995, 1.3913080334975603, 1.3865454458248234,
  1.4696732646975332, 1.4214945837350905, 1.4850224456755907, 1.3473568849451174,
  1.1744568267335451,  1.154654176289603,  1.261928688807406, 1.2549152649424828,
  1.2498803449319025, 1.3404898657322917, 1.4142025172493649, 1.4315770751133883,
   1.482362354685492, 1.4161227382930905, 1.3028728964943537, 1.3529535488705722,
  1.4086537504557515,  1.478274795387206, 1.5197295394474295, 1.5507467308288243,
  1.5166027175203196, 1.5545544738742896, 1.6262770826797261, 1.6885565955740784,
  1.7761070945674908, 1.7797065962668055, 1.8907073367070426,  1.910390171366265,
  1.9342472789902148, 2.0422303129509802,  2.011340451722785, 2.0709164206216473,
  2.1874396760759125,  2.292137311379669, 2.3142942252610825, 2.5258856873484516,
   2.530186147239009,  2.634769003072064, 2.5701564875927994, 2.5900808424001847,
  2.7286073423156965, 2.7796416022588963, 2.7582946855215718,  2.802510786855733,
  2.8126217680682006, 2.6670448182776747,  3.019743872220938,  3.046005692566554,
   3.243040499283871,  3.260773644559238,  3.288287726224284, 3.4223943514706017,
  3.3142822991435916, 3.3115973546132063, 3.3703165990974644, 3.2751202678736213,
   3.295174818868433,  3.326619974666627,  3.420171338109499,  3.328679766329391,
  3.2946485311079257,  3.160149047929498,  3.016040563245828, 3.3615637055719683,
  3.4794149763802493,  3.549636263285913,  3.687373740116667,  3.504625637446807,
  3.7555608458851215,  3.877935650772016,  3.928761693897275,  3.957524975309738,
   4.019942655719227,  4.475571353634709,  4.392367020875791,  4.499302924159586,
  4.7196332976679605, 4.7490787217922605,  4.885300445451637,  5.094786822546272,
   5.038547539223911,  5.219504042103976,   5.24665387068509,  5.460892614314397,
   5.687274196479308,  6.148064783768521,  6.303384534084635,  6.481234610585726,
   6.332980995868691,  6.298965373956964,  6.100015535404986,  6.336015624828802,
   6.371150929349159,  6.583536476048337,   6.75959812512866,  6.872515688516158,
   6.991950235828788,  6.721441310911026, 6.8412426408768106,  6.672846678854323,
  6.3221356610842685,   6.79621819487083,   7.14644808971404,  7.316828500979459,
   7.582488761941764,  7.381595178628784,  7.599338481130215,  7.791259613277692,
   7.514592815604942,  7.530997572174216,  7.376998148214004, 7.6337371565654415,
  7.7381820402175245,  7.949694807602474,  7.912521042374231
],

        lineTension: 0,
        backgroundColor: ['transparent',],
        borderColor: ['#dc3545',],
        borderWidth: 3,
      },
      {
        label: "SPY",
        data: [
                   1,  0.973667017889712, 1.0332413062504844, 1.0356950855302227,
  1.0292406002105312, 1.0524448756688238, 1.0672333300321135, 1.0558096880836148,
  1.0601574732254124, 1.0282475499997763, 1.0431740086819938, 1.0562740994607598,
  1.0828047476742189, 1.1054419556408965, 1.1412746934382136, 1.1614671874598788,
  1.1712673533775075, 1.1884929745746187, 1.2127088379730502,   1.15279352140133,
  1.2140932708086343, 1.2603778554731728, 1.2618820629436558, 1.2835981602915327,
  1.2065722224546012, 1.2383730206133174, 1.2863154943754993, 1.2950829162380904,
   1.215078509869323, 1.2488003558715972, 1.1192316719559894, 1.1453352482899477,
  1.0984674897623887, 1.1360153690868533, 1.1830299332291898, 1.1608004892992423,
   1.081180512531583, 1.0798960404136155,  1.102408523016479, 1.0404315799032369,
  0.7493519770889958,  0.684609809840743, 0.7592525217857936, 0.7382501325200125,
  0.7182882984593362, 0.6603980940529806, 0.7500898557298193, 0.8127652256752381,
  0.8264889652763145, 0.7894901107869727, 0.8686058833186256, 0.9087792772081015,
  0.9225587400135282, 0.9546208376444109,  0.966544745249023,   0.97343426762096,
  1.0091337978055872, 0.9594050020360708, 1.0252952873263352, 1.0659868025008803,
  0.9920676560892773, 0.9524774580660615, 0.9156182691402395, 0.9879182081494596,
  0.9573677220791936,  1.034189029787613, 1.0659841181056464,  1.083457858834389,
  1.1195758026237248, 1.1707359531373256, 1.2052335233525784, 1.1846796041168337,
  1.2081952804239193, 1.2203814006351426, 1.1860067955245337, 1.2238723686243231,
   1.181925425608115, 1.0781083762086636,  1.042991535815785, 1.1388027064776864,
  1.1205221839632344, 1.1169396384907344, 1.1910450423257626,  1.242074328571694,
  1.2717483705995982,    1.2979338759963, 1.2720295610003853, 1.1899512722856247,
  1.2702209937177902, 1.2943000519738532, 1.3207122567484109, 1.3614037829245758,
   1.345402113934844, 1.2795347450186492, 1.3332985058722149, 1.3897182337744332,
  1.4344134034230416, 1.4688092416598888, 1.4726840561643275, 1.5316255423551057,
  1.5513680591248198,  1.530665827052383, 1.6135822081628395,   1.58982386912755,
  1.6289442869831525, 1.6720728039672221, 1.7263415941782798, 1.7077407705046068,
  1.7751424803279514, 1.7321465878707212, 1.8148596810502822, 1.8048595826958007,
  1.8209330922629083, 1.8656671306343144, 1.9051566968411056, 1.9236423555585818,
  1.9379436581965743, 1.9526345832002265, 1.8422186852259042, 1.9963644157183873,
  1.9636192495165867, 2.0074811894854565, 2.0202582176984287, 2.0394235894927792,
  2.0380623260685202, 2.0803167313536277, 2.0844629888236996, 2.0815069415930414,
   2.063451864271787, 1.9625609927052028, 1.9389502183964582,  2.027012189112655,
  2.0197321092373755, 2.0131507092315264, 1.9252195037684212,  1.885395378303132,
    2.01058647368887, 2.0863955223583424,  2.080446495459316, 2.1198714271497083,
    2.05994721026756, 2.2018445403790623, 2.2150209383928474, 2.1626198821757363,
   2.170997835695345, 2.2046135820761483,  2.307397711394644, 2.3281707938986735,
  2.3499964233734034, 2.4430372981535617,  2.426084638145618, 2.4501662927839574,
   2.487524053116442,  2.514339995334879,  2.553120815190109,  2.509996489823188,
   2.577009578428276,  2.649661470256918,  2.682294661972267, 2.7594104170333478,
  2.8561427863270077, 2.8773479574491723, 2.8108072673972133,   2.75987138490349,
  2.7956352195559213,  2.854261949403865, 2.8943640748001958, 2.9464065552227576,
  3.0030846451646522,  3.064397651523831,  2.920271338230219, 2.9394257964177157,
  2.7892586147028835,  2.686542310370531,  2.874629116143292, 2.9849051725281783,
  3.0200769220055412,  3.136932871174361,  3.023284268235956, 3.1432404738679365,
  3.1925845869990894, 3.1032004526154475, 3.2346984905975718, 3.1977217933705324,
   3.334360712265118,  3.398362019433579, 3.4968491470873317
]
,

        lineTension: 0,
        backgroundColor: ['transparent',],
        borderColor: ['#007bff',],
        borderWidth: 2,
      },
      {
        label: "6040",
        data: [
                   1, 0.9782803954617991,  1.013901463552524, 0.9887055331231401,
  1.0351115851805754, 1.0540295911340807, 1.0706133651501053, 1.0706133651501053,
  1.0859341467635324,  1.046281437467693, 1.0619843622315726,  1.068310844281188,
  1.0872911575295645, 1.0958088000940436, 1.1238600892790456, 1.1437674557974342,
  1.1392428065732587, 1.1675885379847197, 1.1951045790163655, 1.1650206846593127,
  1.2072182072073072, 1.2292342359137522, 1.2292342359137522, 1.2528119108755473,
  1.1985021227215884, 1.2159920157475193,  1.242854635346867,  1.257728117473654,
  1.2056713016439842, 1.1973046582692624,  1.143358184818797, 1.1613566936553463,
  1.1405166996556753, 1.1668853202650702, 1.1981928159317403, 1.1934491621403043,
  1.1259668933966784, 1.1326405868727827,  1.129780768748148,  1.085525495141704,
  0.8576986856381442, 0.8098360302399725, 0.8884670931392485, 0.8671745970557514,
  0.8458823487149774, 0.7994266242415515, 0.8943153078618309, 0.9690034214508785,
  0.9854930532321076, 0.9644449553449937, 1.0366073318715687,  1.073664069042924,
  1.0951931594270252, 1.1206624739514008,  1.116743927299402, 1.1240176536509656,
  1.1594814051124929, 1.1141660403937075, 1.1693326467556664, 1.2030996083063672,
  1.1389474972472682, 1.1132865537265395, 1.0998543148916535, 1.1643768013218554,
  1.1415458229276223, 1.2064285272772783, 1.2393036150246541, 1.2502622666402896,
   1.273751125835837, 1.3069266016350272, 1.3240173811339702,  1.315975156855208,
  1.3516266973008804, 1.3556582146346339, 1.3425554736215324, 1.3615352913844625,
  1.3392484798816193, 1.2470611829145228,  1.191009639545487, 1.2602304428487892,
  1.2459787949570982,  1.224602190219093, 1.2864890656891075, 1.3431403941908797,
  1.3565303928914692,  1.354278287666711, 1.3398383553054294, 1.2686690554845848,
  1.3265416317401044, 1.3379595983644523, 1.3639092860290079, 1.4043550197816375,
  1.3960207068322865, 1.3616410775272456, 1.3960207068322865, 1.4549792633147165,
  1.4781411021157114,  1.491827772727268, 1.4905637893537778, 1.5295675365863368,
  1.5253509554383935,  1.494086195391466, 1.5544852519376275,  1.543888924054593,
  1.5858440303479893, 1.6209198167050702, 1.6326115390384945, 1.6028505773210628,
  1.6576740600114648,  1.634115213496629, 1.6855155111099624, 1.6859448492491742,
   1.695603223182379, 1.7159934402681791,  1.740827542450409, 1.7419060903956247,
  1.7419060903956247, 1.7322660494239328, 1.6608550765766592, 1.7236101664199384,
   1.688986386661237, 1.7082023032393254,   1.72895434857228, 1.7355075152135737,
  1.7578644379070671, 1.7786865944306716, 1.7743031585586897, 1.7692855013154543,
  1.7318983992227839,  1.680216294261872, 1.6761528181168333, 1.7147738028421318,
  1.6860835851741363, 1.6750493720279414,  1.624909589389974, 1.6071023379356935,
  1.6816699246899312, 1.7172846753412159, 1.7389476706671778, 1.7422982671263647,
  1.7188439680406962, 1.7895980510575487, 1.8120523366412384, 1.7884754049076128,
  1.7907649192835657, 1.7997697479131112, 1.8571729755796311,  1.861035903990283,
  1.8837593620426714, 1.9087548686090303,  1.907618844352045, 1.9307336120356415,
   1.946680439510458, 1.9592103993476466, 1.9879034660569577, 1.9661588395037195,
  2.0096482164815583, 2.0437222551375993,   2.04487054265938, 2.0770190009997695,
  2.1328925412222253,  2.127087185990747, 2.0910940083298573, 2.0841274829549934,
   2.096340951463363,  2.114933299607293, 2.1219058946788727,  2.131362482164074,
   2.139533037173426,  2.154706907352027,  2.075367424135915,  2.076539123345034,
  2.0156025889610074, 1.9848409943847891, 2.0780486197571624, 2.1246519988935826,
  2.1270418490724095, 2.1792632899416104, 2.1217879691426553,  2.181658094974901,
  2.1977115756920327, 2.1495953556167215,   2.21695808849643, 2.1993885461850087,
  2.2633668657238206,  2.281473762001746, 2.3241457118645648
],

        lineTension: 0,
        backgroundColor: ['transparent',],
        borderColor: ['#28a745',],
        borderWidth: 2,
      }]
    },
    
    options: {
      responsive: true,
      
      scales: {
        yAxes: [{
          title: {
            text: "y-asix"
          },
          ticks: {
            beginAtZero: false
          }
        }]
      },
    
      elements: {
        point:{
          radius: 0
        }
      },
      
      legend: {
        display: true
      }
      
    }
  })

  // doughnut chart
  var ctxD = document.getElementById("doughnutChart").getContext('2d');
  var myLineChart = new Chart(ctxD, {
    type: 'doughnut',
    data: {
      labels: ["APA", "CNC", "ABC", "LEG", "MET", "STZ", "BWA", "AVY", "LVS", "ETFC"],
      datasets: [{
        data: [9.75, 9.76, 9.77, 9.80, 9.80, 9.80, 9.84, 10.28, 10.52, 10.67],
        backgroundColor: ["#007bff", "#6610f2", "#6f42c1", "#e83e8c", "#dc3545", "#fd7e14", "#ffc107", "#28a745", "#20c997", "#17a2b8"],
      }]
    },
    options: {
      responsive: true
    }
  });

  // doughnut chart 2
  var ctxD = document.getElementById("doughnutChart2").getContext('2d');
  var myLineChart = new Chart(ctxD, {
    type: 'doughnut',
    data: {
      labels: ["Energy", "Health Care", "Consumer Discretionary", "Financials", "Consumer Staples", "Materials"],
      datasets: [{
        data: [9.75, 19.53, 30.16, 20.47, 9.80, 10.28],
        backgroundColor: ["#007bff", "#28a745", "#6f42c1", "#e83e8c", "#dc3545", "#ffc107"],
      }]
    },
    options: {
      responsive: true
    }
  });
  
})()

//line
/*
var ctxL = document.getElementById("myChart").getContext('2d');
var myLineChart = new Chart(ctxL, {
  type: 'line',
  data: {
    labels: ["January", "February", "March", "April", "May", "June", "July"],
    datasets: [
      {
        label: "My First dataset",
        data: [65, 59, 80, 81, 56, 55, 40],
        backgroundColor: ['rgba(105, 0, 132, .2)',],
        borderColor: ['rgba(200, 99, 132, .7)',],
        borderWidth: 2
      },
      {
        label: "My Second dataset",
        data: [28, 48, 40, 19, 86, 27, 90],
        backgroundColor: ['rgba(0, 137, 132, .2)',],
        borderColor: ['rgba(0, 10, 130, .7)',],
        borderWidth: 2
      }
    ]
  },
  options: {
    responsive: true
  }
});
*/

/*
async function main(){
  var [indices, returns] = await getReturn("timeseries_L104_C10_R0.2");
  alert(returns)
    
  feather.replace()
  // Graphs
  var ctx = document.getElementById('myChart')
  // eslint-disable-next-line no-unused-vars
  var myChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: indices
      datasets: [{
          data: returns
          lineTension: 0,
          backgroundColor: 'transparent',
          borderColor: '#007bff',
          borderWidth: 4,
          pointBackgroundColor: '#007bff'
      }]
    },
    options: {
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero: false
          }
        }]
      },
      legend: {
        display: false
      }
    }
  })
}
*/

async function getReturn(collection){
    /**
     * Connection URI. Update <username>, <password>, and <your-cluster-url> to reflect your cluster.
     * See https://docs.mongodb.com/ecosystem/drivers/node/ for more details
     */
    const {MongoClient} = require('mongodb');
    const uri = "mongodb+srv://admin:admin@mie479.mvqsq.mongodb.net/MIE479?retryWrites=true&w=majority";
    const client = new MongoClient(uri);

    try {
        // Connect to the MongoDB cluster
        await client.connect();
 
        // Make the appropriate DB calls
        const data = await readData(client, collection);

        var indices=[], returns=[];

        data.forEach((result, i) => {
            indices.push(result.index);
            returns.push(result.ret);
        });
 
    } catch (e) {
        console.error(e);
    } finally {
        await client.close();
        return [indices, returns];
    }
}


async function readData(client, collection){
    const db = client.db("MIE479")
    const cursor = db.collection(collection).find()
    const results = await cursor.toArray();

    return results
}
